<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="UTF-8">
	<title>DWD</title>
  <meta name="author" content="DJ">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="mobile-web-app-capable" content="yes">
	<link rel="icon" sizes="128x128" href="pics/icon.png">
	<meta name="theme-color" content="#5ac1f2">
	<link rel="manifest" href="dwd.manifest">

<style>
html {height:99%;}
body {height:99%; font-family:Helvetica;background:#CCCCCC;}
</style>
<script></script>
</head>
<body>
<span id="warn">no warning</span>

<script>
var dreg=109772000, dlev=3  //Augsburg 8097610000
	
navigator.serviceWorker.register('sw_pb.js');
	
navigator.serviceWorker.ready.then(function(registration) {
  registration.periodicSync.register({
    tag: 'get-latest-news',         // default: ''
    minPeriod: 60 * 1000, // default: 0   //12 * 60 * 
    powerState: 'auto',   // default: 'auto'   //avoid-draining
    networkState: 'online'  // default: 'online'   //avoid-cellular
  }).then(function(periodicSyncReg) {
    console.log("dj")   // success
  }, function() {
    // failure
  })
});	

	
function showNotification(tx) {
  Notification.requestPermission(function(result) {
    if (result === 'granted') {
      navigator.serviceWorker.ready.then(function(registration) {
        registration.showNotification('Vibration Sample', {
          body: 'Buzz! '+new Date(tx).toTimeString(),  //Buzz!
          icon: 'orange.png',  //../images/touch/chrome-touch-icon-192x192.png
          vibrate: [200, 100, 200, 100, 200, 100, 200],
          tag: 'vibration-sample'
        });
      });
    }
  });
}
	
if(typeof(Notification) != "undefined") Notification.requestPermission();  //
var warnWetter = function(a) {}
warnWetter.loadWarnings = function(a) { 
b=decodeURI(location.search.slice(1))||dreg  //Augsburg   ?108111000
if(1*b) {
a=a.warnings[b]; var c=a
a=a||"no warning"
document.getElementById("warn").innerHTML=JSON.stringify(a)
//document.getElementById("warn").title=new Date(a[0].start).toTimeString()+" - "+new Date(a[0].end).toTimeString()
//if(c) new Notification(" warning",{tag:"1"})  // not chrome android!
if(c) showNotification(a[0].start) }
else { // ?Ulm
  for (var x in a.warnings) {
    if (a.warnings[x][0].regionName.match(b)) {
      document.getElementById("warn").innerHTML = "<h3>"+a.warnings[x][0].headline+"</h3>"+a.warnings[x][0].description  //JSON.stringify(a.warnings[x])
      if(a.warnings[x][0].level>=dlev) showNotification(a.warnings[x][0].start)
      document.getElementById("warn").title="last update: "+new Date(a.time).toTimeString()
      console.log(a.warnings[x])  //.length+" warnings"
    }
  }
}
  }
function update() {
var script = document.createElement('script');
script.src = "https://www.dwd.de/DWD/warnungen/warnapp/json/warnings.json"
document.head.replaceChild(script,document.getElementsByTagName("script")[0])
setTimeout(function(){update()},10*60000)  //
}; if(navigator.onLine) update()
</script>
</body>
</html>
